<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Investment Calculator (Decreasing Contributions + Withdrawals with Inflation & Tax)</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; }
  input, select { padding: 5px; width: 200px; }
  button { margin-top: 15px; padding: 8px 15px; }
  table { border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: right; }
  th { background-color: #f4f4f4; }
  .tooltip {
    display: inline-block;
    position: relative;
    cursor: pointer;
    font-weight: bold;
    color: #0077cc;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    text-align: center;
    line-height: 18px;
    font-size: 12px;
    background-color: #e0e0e0;
    margin-left: 5px;
  }
  .tooltip-text {
    visibility: hidden;
    opacity: 0;
    width: 250px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1;
    bottom: 125%; /* Above the icon */
    left: 50%;
    transform: translateX(-50%);
    transition: opacity 0.3s;
    font-size: 13px;
  }
  .tooltip-text::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
  }
  .tooltip:focus .tooltip-text,
  .tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }
</style>

</head>
<body>

<h2>Investment Calculator (Decreasing Contributions + Withdrawals with Inflation & Tax)</h2>

<label>Initial Investment:
  <input type="number" id="initial" value="0">
</label>

<label>Annual Interest Rate (%):
  <input type="number" id="rate" value="7">
  <span class="tooltip" tabindex="0">?
    <span class="tooltip-text">
      Common averages:<br>
      • S&P 500 ETF: ~8%<br>
      • Govt Bonds: ~4%<br>
      • Corp Bonds: ~5–7%<br>
      • Deposits/CDs: ~3–5%<br>
      • REITs: ~6–9%
    </span>
  </span>
</label>
  
<label>Number of Years:
  <input type="number" id="years" value="50">
</label>

<label>Starting Annual Contribution:
  <input type="number" id="contribution" value="18000">
</label>

<label>Contribution Decrease Type:
  <select id="decreaseType">
    <option value="fixed" selected>Fixed Amount</option>
    <option value="percent">Percentage</option>
  </select>
</label>

<label>Decrease Value:
  <input type="number" id="decreaseValue" value="1500">
</label>

<label>Contribution Limit Years (leave blank for no limit):
  <input type="number" id="contributionLimit" placeholder="">
</label>

<label>Compounding Frequency:
  <select id="frequency">
    <option value="1">Yearly</option>
    <option value="12" selected>Monthly</option>
  </select>
</label>

<hr>

<label>Monthly Withdrawal (after start year) - Net (after tax):
  <input type="number" id="monthlyWithdrawal" value="1000">
</label>

<label>Investment Tax Fee (%):
  <input type="number" id="taxRate" value="0">
</label>

<label>Withdrawals Start After Year:
  <input type="number" id="withdrawStartYear" value="20">
</label>

<label>Withdrawal Inflation Rate (% per year):
  <input type="number" id="withdrawInflation" value="3">
</label>

<button onclick="calculate()">Calculate</button>

<div id="results"></div>

<script>
function calculate() {
  const initial = parseFloat(document.getElementById('initial').value);
  const rate = parseFloat(document.getElementById('rate').value) / 100;
  const years = parseInt(document.getElementById('years').value);
  const startContribution = parseFloat(document.getElementById('contribution').value);
  const decreaseType = document.getElementById('decreaseType').value;
  const decreaseValue = parseFloat(document.getElementById('decreaseValue').value);
  const contributionLimit = parseInt(document.getElementById('contributionLimit').value) || 0;
  const freq = parseInt(document.getElementById('frequency').value);

  let netMonthlyWithdrawal = parseFloat(document.getElementById('monthlyWithdrawal').value);
  const taxRate = parseFloat(document.getElementById('taxRate').value) / 100;
  const withdrawStartYear = parseInt(document.getElementById('withdrawStartYear').value);
  const withdrawInflation = parseFloat(document.getElementById('withdrawInflation').value) / 100;

  let balance = initial;
  let annualContribution = startContribution;

  let output = `<table><tr>
                  <th>Year</th>
                  <th>Annual Contribution</th>
                  <th>Monthly Contribution</th>
                  <th>Annual Withdrawal (Gross)</th>
                  <th>Monthly Withdrawal (Gross)</th>
                  <th>End Balance</th>
                </tr>`;

  for (let y = 1; y <= years; y++) {
    let perPeriodRate = rate / freq;
    let periodContribution = 0;

    // Stop contributions after limit year (if set)
    if (contributionLimit === 0 || y <= contributionLimit) {
      periodContribution = annualContribution / freq;
    }

    let monthlyContributionDisplay = (contributionLimit === 0 || y <= contributionLimit) ? annualContribution / 12 : 0;
    let grossMonthlyWithdrawalDisplay = 0;
    let grossAnnualWithdrawalDisplay = 0;
    let periodWithdrawal = 0;

    if (y > withdrawStartYear) {
      let grossMonthlyWithdrawal = netMonthlyWithdrawal / (1 - taxRate);
      grossMonthlyWithdrawalDisplay = grossMonthlyWithdrawal;
      grossAnnualWithdrawalDisplay = grossMonthlyWithdrawal * 12;
      periodWithdrawal = grossAnnualWithdrawalDisplay / freq;
    }

    for (let p = 0; p < freq; p++) {
      balance += periodContribution;
      if (y > withdrawStartYear) balance -= periodWithdrawal;
      balance *= (1 + perPeriodRate);
    }

    output += `<tr>
                 <td>${y}</td>
                 <td>${(contributionLimit === 0 || y <= contributionLimit) ? annualContribution.toFixed(2) : "0.00"}</td>
                 <td>${monthlyContributionDisplay.toFixed(2)}</td>
                 <td>${grossAnnualWithdrawalDisplay.toFixed(2)}</td>
                 <td>${grossMonthlyWithdrawalDisplay.toFixed(2)}</td>
                 <td>${balance.toFixed(2)}</td>
               </tr>`;

    // Decrease contribution only if still contributing next year
    if ((contributionLimit === 0 || y < contributionLimit)) {
      if (decreaseType === "fixed") {
        annualContribution = Math.max(0, annualContribution - decreaseValue);
      } else if (decreaseType === "percent") {
        annualContribution = Math.max(0, annualContribution * (1 - decreaseValue / 100));
      }
    }

    // Apply withdrawal inflation after each year if in withdrawal phase
    if (y >= withdrawStartYear) {
      netMonthlyWithdrawal *= (1 + withdrawInflation);
    }
  }

  output += "</table>";
  document.getElementById('results').innerHTML = output;
}
</script>

</body>
</html>
